FROM node:22-alpine AS base
WORKDIR /app
RUN corepack enable && corepack prepare pnpm@10.24.0 --activate

FROM base AS dev
WORKDIR /app

ENV PNPM_HOME=/root/.local/share/pnpm \
    PNPM_STORE_DIR=/pnpm-store \
    CHOKIDAR_USEPOLLING=true \
    CHOKIDAR_INTERVAL=200

COPY package.json pnpm-lock.yaml ./
RUN pnpm install --frozen-lockfile --prefer-offline --reporter=silent

COPY . .
EXPOSE 5173
CMD ["pnpm", "exec", "vite", "--host"]
